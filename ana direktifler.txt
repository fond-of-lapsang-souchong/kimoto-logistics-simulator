ANA DİREKTİF: Proje Bütünlüğünü Koruma Protokolü

AMAÇ: Bu direktifler, projenin temel mimarisini, veri akışını ve ana mantığını korumayı hedefler. Her yeni özellik eklenirken veya değişiklik yapılırken bu prensiplere sadık kalınacaktır.

    SORUMLULUKLARIN AYRIŞMASINA (SEPARATION OF CONCERNS) KESİNLİKLE UYULACAK:

        ui_manager.py: Sadece arayüz çizimi ve kullanıcı etkileşimini yönetir. Kesinlikle yeni KPI hesaplaması, simülasyon mantığı veya karmaşık veri analizi içermemelidir. Gerekli verileri her zaman st.session_state üzerinden hazır olarak almalıdır.

        simulation_engine.py: Sadece simülasyon mantığını, KPI hesaplamalarını ve analitik fonksiyonları (örn: risk matrisi, ABC analizi) içerir. Kesinlikle st. komutları kullanarak arayüze bir şey çizmemelidir.

        app.py: Ana orkestratördür. UI'dan girdileri alır, simülasyon motorunu tetikler ve sonuçları tekrar UI'a sunulmak üzere st.session_state'e kaydeder. Modüller arası veri akışını yönetir.

        config.py & event_library.py: Tüm ayarlanabilir parametrelerin (KPI hedefleri, strateji etkileri, kriz senaryoları vb.) tek ve merkezi kaynağıdır. Kod içinde sihirli sayılar (magic numbers) veya sabit parametreler kullanılmayacaktır. Değişiklikler sadece bu dosyalarda yapılmalıdır.

    VERİ AKIŞI HİYERARŞİSİ DEĞİŞTİRİLMEYECEK:

        Girdi: Kenar çubuğu (ui_manager.py) -> params sözlükleri.

        Tetikleme: Ana Panel (app.py) -> "Analizi Başlat" butonu.

        İşleme: app.py -> run_..._flow fonksiyonları -> simulation_engine.py (KimotoSimulator).

        Depolama: app.py -> İşlenmiş sonuçları st.session_state['last_results'] ve st.session_state['comparison_results']'e kaydeder.

        Görselleştirme: ui_manager.py -> st.session_state'den sonuçları okur ve çizer.

        Bu akış, projenin öngörülebilir ve yönetilebilir kalması için kritiktir.

    st.session_state KULLANIM KURALLARI:

        st.session_state['last_results']: Her zaman tek bir simülasyonun (veya optimizasyonun/monte carlo'nun) tüm işlenmiş verilerini içeren tek bir sözlüktür. Bu yapı (results_df, final_tesis_df, params vb. anahtarları) korunacaktır.

        st.session_state['params_main'] ve st.session_state['params_compare']: Sidebar'daki kullanıcı seçimlerini tutan tekil doğruluk kaynaklarıdır (single source of truth).

        st.session_state['erp_data']: Yüklenen ham ERP verisini tutar. Sadece manage_erp_data_sourcing fonksiyonu tarafından değiştirilebilir.

    TESTLERİN BÜTÜNLÜĞÜ KORUNACAK:

        simulation_engine.py'da yapılan her kritik mantıksal değişiklik (örn: yeni bir kriz etkisi, KPI hesaplama formülü değişikliği), test_simulation.py içinde karşılık gelen bir test senaryosu ile doğrulanmalıdır.

        Testler, projenin temel işlevselliğinin (kriz etkisi, müdahale, domino vb.) bozulmadığından emin olmak için düzenli olarak çalıştırılacaktır.
